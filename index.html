<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیرت النبی ﷺ - جامع ڈیجیٹل آرکائیو</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --bg-card-hover: #f1f5f9;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --font-urdu: 'Noto Nastaliq Urdu', 'Arial Unicode MS', sans-serif;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark {
            --bg-secondary: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-light: #334155;
            --border-medium: #475569;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-urdu);
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            direction: rtl;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background: var(--bg-primary);
            padding: 1rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: white;
            text-decoration: none;
        }

        .nav-brand i {
            font-size: 2rem;
        }

        .nav-brand h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
        }

        .nav-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-urdu);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .main-content {
            flex: 1;
            max-width: 1280px;
            margin: 0 auto;
            padding: 2rem 1rem;
            width: 100%;
        }

        .search-section {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .search-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: var(--font-urdu);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .input-with-icon input {
            padding-right: 3rem;
        }

        .filter-pills {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .pill {
            background: var(--accent-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .pill-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            margin-right: 0.25rem;
        }

        .tabs {
            display: flex;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .tab {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--font-urdu);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab.active {
            background: var(--accent-primary);
            color: white;
        }

        .tab:hover:not(.active) {
            background: var(--bg-card-hover);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            text-align: center;
            border-left: 4px solid var(--accent-primary);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .event-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .event-header {
            padding: 1.25rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .event-meta {
            font-size: 0.875rem;
            opacity: 0.9;
            display: flex;
            gap: 1rem;
        }

        .event-body {
            padding: 1.25rem;
        }

        .event-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .event-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .event-footer {
            padding: 0 1.25rem 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .event-location {
            color: var(--text-muted);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 2rem 0;
        }

        .page-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-light);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:hover {
            background: var(--bg-card-hover);
        }

        .page-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: var(--bg-card);
            margin: 2rem auto;
            padding: 0;
            border-radius: var(--radius-xl);
            max-width: 800px;
            box-shadow: var(--shadow-xl);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 2rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .detail-grid {
            display: grid;
            gap: 1.5rem;
        }

        .detail-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 1rem;
            align-items: start;
        }

        .detail-label {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .detail-value {
            color: var(--text-secondary);
        }

        .timeline-container {
            position: relative;
            padding: 2rem 0;
        }

        .timeline-line {
            position: absolute;
            right: 2rem;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-primary);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding-right: 5rem;
        }

        .timeline-marker {
            position: absolute;
            right: 1rem;
            top: 0.5rem;
            width: 1.5rem;
            height: 1.5rem;
            background: var(--accent-primary);
            border-radius: 50%;
            border: 3px solid var(--bg-card);
        }

        .timeline-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition);
        }

        .timeline-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(-5px);
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-primary);
            text-align: center;
        }

        .chart-svg {
            width: 100%;
            height: 300px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .loading i {
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .insight-panel {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .insight-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .insight-card {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .insight-card:hover {
            background: var(--bg-card-hover);
            transform: translateY(-2px);
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .export-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-brand h1 {
                font-size: 1.25rem;
            }
            
            .events-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 1rem;
                max-width: none;
            }
            
            .detail-item {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translate(-50%, 100%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .toast.success { border-left: 4px solid var(--accent-success); }
        .toast.error { border-left: 4px solid var(--accent-danger); }
        .toast.warning { border-left: 4px solid var(--accent-warning); }




        
    </style>
</head>
<body>
<div class="app-container">
<nav class="navbar">
<div class="nav-content">
<a href="#" class="nav-brand">
<i class="fas fa-mosque"></i>
<h1>سیرت النبی ﷺ - جامع ڈیجیٹل آرکائیو</h1>
</a>
<div class="nav-actions">
<button class="btn btn-secondary" id="themeToggle">
<i class="fas fa-moon"></i>
تھیم
</button>
<button class="btn btn-secondary" id="exportBtn">
<i class="fas fa-download"></i>
ایکسپورٹ
</button>
</div>
</div>
</nav>

        <main class="main-content">
            <div class="search-section">
                <div class="search-header">
                    <h2 class="search-title">
                        <i class="fas fa-search"></i>
                        تلاش اور فلٹر
                    </h2>
                    <button class="btn btn-primary" id="clearFilters">
                        <i class="fas fa-times"></i>
                        صاف کریں
                    </button>
                </div>
                
                <div class="search-grid">
                    <div class="input-group">
                        <label>عمومی تلاش</label>
                        <div class="input-with-icon">
                            <input type="search" id="searchInput" placeholder="واقعہ، تفصیل، شخصیات، مقام...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>دور</label>
                        <select id="periodFilter">
                            <option value="">تمام ادوار</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label>ٹیگز</label>
                        <select id="tagFilter">
                            <option value="">تمام ٹیگز</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-pills" id="activePills"></div>
            </div>
    
            <div class="stats-row" id="statsRow">
                <div class="stat-card">
                    <div class="stat-value" id="totalEventsCount">0</div>
                    <div class="stat-label">کل واقعات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="filteredEventsCount">0</div>
                    <div class="stat-label">فلٹرڈ واقعات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniquePeriodsCount">0</div>
                    <div class="stat-label">مختلف ادوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniqueLocationCount">0</div>
                    <div class="stat-label">مختلف مقامات</div>
                </div>
            </div>
    
            <div class="tabs">
                <button class="tab active" data-tab="events">
                    <i class="fas fa-list"></i>
                    واقعات کی فہرست
                </button>
                <button class="tab" data-tab="timeline">
                    <i class="fas fa-timeline"></i>
                    ٹائم لائن
                </button>
                <button class="tab" data-tab="analytics">
                    <i class="fas fa-chart-bar"></i>
                    تجزیاتی رپورٹ
                </button>
                <button class="tab" data-tab="insights">
                    <i class="fas fa-lightbulb"></i>
                    ذہین بصیرت
                </button>
            </div>
    
            <div id="eventsTab" class="tab-content active">
                <div id="loadingIndicator" class="loading" style="display: none;">
                    <span>ڈیٹا لوڈ ہو رہا ہے...</span>
                    <i class="fas fa-spinner"></i>
                </div>
                
                <div class="events-grid" id="eventsGrid"></div>
                
                <div class="pagination" id="pagination"></div>
                
                <div id="emptyState" class="empty-state" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>کوئی واقعات نہیں ملے</h3>
                    <p>مختلف فلٹرز آزمائیں یا تلاش کی شرائط تبدیل کریں</p>
                </div>
            </div>
    
            <div id="timelineTab" class="tab-content">
                <div class="timeline-container" id="timelineContainer"></div>
            </div>
    
            <div id="analyticsTab" class="tab-content">
                <div class="chart-container">
                    <h3 class="chart-title">ادوار کے لحاظ سے واقعات کی تقسیم</h3>
                    <svg class="chart-svg" id="periodsChart"></svg>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">مقامات کے لحاظ سے واقعات کی تقسیم</h3>
                    <svg class="chart-svg" id="locationsChart"></svg>
                </div>
                
                <div class="chart-container">
                    <h3 class="chart-title">ٹیگز کی مقبولیت</h3>
                    <svg class="chart-svg" id="tagsChart"></svg>
                </div>
            </div>
    
            <div id="insightsTab" class="tab-content">
                <div class="insight-panel">
                    <h3 class="insight-title">
                        <i class="fas fa-users"></i>
                        اہم شخصیات
                    </h3>
                    <div class="insight-grid" id="personalitiesGrid"></div>
                </div>
    
                <div class="insight-panel">
                    <h3 class="insight-title">
                        <i class="fas fa-map-marker-alt"></i>
                        اہم مقامات
                    </h3>
                    <div class="insight-grid" id="locationsGrid"></div>
                </div>
    
                <div class="insight-panel">
                    <h3 class="insight-title">
                        <i class="fas fa-tags"></i>
                        موضوعات کی تقسیم
                    </h3>
                    <div class="insight-grid" id="topicsGrid"></div>
                </div>
            </div>
    
            <div class="export-section">
                <h3><i class="fas fa-file-export"></i> ڈیٹا ایکسپورٹ و امپورٹ</h3>
                <div class="export-grid">
                    <button class="btn btn-primary" id="exportJSON">
                        <i class="fas fa-file-code"></i>
                        JSON ایکسپورٹ
                    </button>
                    <button class="btn btn-primary" id="exportCSV">
                        <i class="fas fa-file-csv"></i>
                        CSV ایکسپورٹ
                    </button>
                    <input type="file" id="importFile" accept=".json,.csv" style="display: none;">
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                        <i class="fas fa-file-import"></i>
                        ڈیٹا امپورٹ
                    </button>
                </div>
            </div>
        </main>
    </div>
    
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close">&times;</button>
                <h2 class="modal-title" id="modalTitle"></h2>
                <div class="event-meta" id="modalMeta"></div>
            </div>
            <div class="modal-body">
                <div class="detail-grid" id="modalDetails"></div>
            </div>
        </div>
    </div>
    
<script>
class CSVDataLoader {
    constructor() {
        this.baseFiles = {
            history: 'history.csv',
            details: 'details.csv'
        };
        this.updateFiles = {
            history: 'historynew.csv', 
            details: 'detailsnew.csv'
        };
        this.lastFetchTime = localStorage.getItem('lastFetch') || 0;
        this.autoFetchInterval = 24 * 60 * 60 * 1000;
    }

    async loadAllData() {
        try {
            const [historyData, detailsData, updateData] = await Promise.all([
                this.loadCSV(this.baseFiles.history),
                this.loadCSV(this.baseFiles.details),
                this.checkAndLoadUpdates()
            ]);

            const combinedData = this.combineHistoryDetails(historyData, detailsData);
            
            if (updateData.history.length > 0 || updateData.details.length > 0) {
                const newCombinedData = this.combineHistoryDetails(updateData.history, updateData.details);
                combinedData.push(...newCombinedData);
            }

            return {
                events: combinedData,
                lastUpdated: Date.now()
            };
        } catch (error) {
            console.error('خرابی CSV ڈیٹا لوڈ کرنے میں:', error);
            throw error;
        }
    }

    async loadCSV(filename) {
        try {
            const response = await fetch(filename);
            if (!response.ok) throw new Error(`فائل نہیں ملی: ${filename}`);
            const text = await response.text();
            return this.parseCSV(text);
        } catch (error) {
            console.warn(`فائل لوڈ نہیں ہو سکی: ${filename}`, error);
            return [];
        }
    }

    async checkAndLoadUpdates() {
        const [historyUpdates, detailsUpdates] = await Promise.all([
            this.loadCSV(this.updateFiles.history),
            this.loadCSV(this.updateFiles.details)
        ]);

        return {
            history: historyUpdates,
            details: detailsUpdates
        };
    }

    parseCSV(text) {
        const lines = text.split('\n').filter(line => line.trim());
        if (lines.length <= 1) return [];

        const headers = this.parseCSVLine(lines[0]);
        return lines.slice(1).map(line => {
            const values = this.parseCSVLine(line);
            const row = {};
            headers.forEach((header, index) => {
                row[header.trim()] = values[index] ? values[index].trim() : '';
            });
            return row;
        }).filter(row => row.شمار);
    }

    parseCSVLine(line) {
        const result = [];
        let current = '';
        let inQuotes = false;
        let i = 0;

        while (i < line.length) {
            const char = line[i];
            
            if (char === '"') {
                if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
                    current += '"';
                    i += 2;
                    continue;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (char === ',' && !inQuotes) {
                result.push(current);
                current = '';
                i++;
                continue;
            } else {
                current += char;
            }
            i++;
        }
        
        result.push(current);
        return result;
    }

    combineHistoryDetails(historyRows, detailsRows) {
        const detailsMap = new Map();
        detailsRows.forEach(detail => {
            detailsMap.set(detail.شمار, detail);
        });

        return historyRows.map(history => {
            const detail = detailsMap.get(history.شمار) || {};
            
            return {
                id: parseInt(history.شمار) || Date.now() + Math.random(),
                title: history['واقعہ (اردو)'] || '',
                description: history['مختصر تفصیل (اردو)'] || '',
                detailedDescription: detail['تفصیلی وضاحت'] || history['مختصر تفصیل (اردو)'] || '',
                year: this.parseYear(history['عیسوی سال (تقریباً)']),
                hijriYear: history['ہجری سال / دور'] || '',
                period: this.determinePeriod(history['ہجری سال / دور']),
                location: detail['مقام'] || '',
                coordinates: detail['نقشہ_کوآرڈینیٹس'] || '',
                personalities: detail['متعلقہ شخصیات'] ? 
                    detail['متعلقہ شخصیات'].split(';').map(p => p.trim()).filter(p => p) : [],
                tags: detail['ٹیگز'] ? 
                    detail['ٹیگز'].split(';').map(t => t.trim()).filter(t => t) : [],
                significance: parseInt(detail['اہمیت_اسکور']) || 3,
                imageRef: detail['تصویری_حوالہ'] || '',
                sources: []
            };
        }).filter(event => event.title);
    }

    parseYear(yearStr) {
        if (!yearStr) return 0;
        const match = yearStr.match(/\d+/);
        return match ? parseInt(match[0]) : 0;
    }

    determinePeriod(hijriYear) {
        if (!hijriYear) return 'نامعلوم';
        
        const lowerCase = hijriYear.toLowerCase();
        
        if (lowerCase.includes('عام الفیل') || lowerCase.includes('قبل')) {
            return 'قبل از نبوت';
        } else if (lowerCase.includes('مکہ') || lowerCase.includes('مکی')) {
            return 'مکی دور';
        } else if (lowerCase.includes('مدینہ') || lowerCase.includes('مدنی') || lowerCase.includes('ہجری')) {
            return 'مدنی دور';
        } else {
            return 'نامعلوم';
        }
    }

    async checkForUpdates() {
        const now = Date.now();
        const timeSinceLastFetch = now - this.lastFetchTime;
        
        if (timeSinceLastFetch > this.autoFetchInterval) {
            try {
                const updateData = await this.checkAndLoadUpdates();
                
                if (updateData.history.length > 0 || updateData.details.length > 0) {
                    localStorage.setItem('lastFetch', now.toString());
                    return updateData;
                }
            } catch (error) {
                console.warn('اپ ڈیٹ چیک کرنے میں خرابی:', error);
            }
        }
        
        return null;
    }
}

class SeerahApp {
    constructor() {
        this.db = null;
        this.events = [];
        this.filteredEvents = [];
        this.currentPage = 1;
        this.itemsPerPage = 12;
        this.filters = {
            search: '',
            period: '',
            tag: ''
        };
        this.initializeTimeline(); // Add this line here
        this.init();
    }

    generateSampleData() {
        return [
            {
                id: 1,
                title: 'ولادت مبارک',
                description: 'نبی اکرم صلی اللہ علیہ وسلم کی مکہ مکرمہ میں ولادت ہوئی۔ یہ عام الفیل کا سال تھا۔',
                detailedDescription: 'حضور نبی اکرم صلی اللہ علیہ وسلم کی ولادت 12 ربیع الاول بروز پیر عام الفیل میں ہوئی۔ والد گرامی حضرت عبداللہ اور والدہ ماجدہ حضرت آمنہ تھیں۔',
                year: 570,
                hijriYear: 'عام الفیل',
                period: 'قبل از نبوت',
                location: 'مکہ مکرمہ',
                coordinates: '21.3891,39.8579',
                personalities: ['حضرت آمنہ', 'حضرت عبداللہ', 'عبدالمطلب'],
                tags: ['ولادت', 'مکی دور', 'ابتدائی زندگی'],
                significance: 5,
                imageRef: 'birth.jpg'
            }
        ];
    }

    async init() {
        await this.initDB();
        await this.loadData();
        this.setupEventListeners();
        this.applyFilters();
        this.updateStats();
        this.loadTheme();
    }

    async initDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open('SeerahDBz', 1);
            
            request.onerror = () => reject(request.error);
            
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                const store = db.createObjectStore('events', { keyPath: 'id' });
                store.createIndex('period', 'period', { unique: false });
                store.createIndex('year', 'year', { unique: false });
                store.createIndex('location', 'location', { unique: false });
            };
        });
    }

    async loadData() {
        this.dataLoader = new CSVDataLoader();
        
        try {
            const cachedEvents = await this.getEventsFromDB();
            
            if (cachedEvents.length === 0) {
                const csvData = await this.dataLoader.loadAllData();
                this.events = csvData.events;
                
                if (this.events.length > 0) {
                    await this.addEventsToDB(this.events);
                    this.showToast(`${this.events.length} واقعات CSV سے لوڈ کیے گئے`, 'success');
                } else {
                    this.events = this.generateSampleData();
                    this.showToast('نمونہ ڈیٹا استعمال کیا گیا', 'warning');
                }
            } else {
                this.events = cachedEvents;
                this.checkForUpdatesInBackground();
            }
        } catch (error) {
            console.error('ڈیٹا لوڈ کرنے میں خرابی:', error);
            this.events = this.generateSampleData();
            this.showToast('CSV فائلیں نہیں ملیں، نمونہ ڈیٹا استعمال کیا گیا', 'warning');
        }
    }

    async getEventsFromDB() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction(['events'], 'readonly');
            const store = transaction.objectStore('events');
            const request = store.getAll();
            
            request.onsuccess = () => resolve(request.result);
            request.onerror = () => reject(request.error);
        });
    }

    async addEventsToDB(events) {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction(['events'], 'readwrite');
            const store = transaction.objectStore('events');
            
            events.forEach(event => store.put(event));
            
            transaction.oncomplete = () => resolve();
            transaction.onerror = () => reject(transaction.error);
        });
    }

    async checkForUpdatesInBackground() {
        try {
            const updates = await this.dataLoader.checkForUpdates();
            
            if (updates && (updates.history.length > 0 || updates.details.length > 0)) {
                const newCombinedData = this.dataLoader.combineHistoryDetails(updates.history, updates.details);
                
                if (newCombinedData.length > 0) {
                    await this.addEventsToDB(newCombinedData);
                    this.events.push(...newCombinedData);
                    
                    this.applyFilters();
                    this.updateStats();
                    
                    this.showToast(`${newCombinedData.length} نئے واقعات شامل کیے گئے`, 'success');
                }
            }
        } catch (error) {
            console.warn('بیک گراؤنڈ اپ ڈیٹ ناکام:', error);
        }
    }

    setupEventListeners() {
        document.getElementById('searchInput').addEventListener('input', 
            this.debounce(() => this.handleSearch(), 300));
        
        document.getElementById('periodFilter').addEventListener('change', () => this.handlePeriodFilter());
        document.getElementById('tagFilter').addEventListener('change', () => this.handleTagFilter());
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
        });
        
        document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
        document.getElementById('clearFilters').addEventListener('click', () => this.clearFilters());
        document.getElementById('exportJSON').addEventListener('click', () => this.exportJSON());
        document.getElementById('exportCSV').addEventListener('click', () => this.exportCSV());
        document.getElementById('importFile').addEventListener('change', (e) => this.importData(e));
        
        document.querySelector('.modal-close').addEventListener('click', () => this.closeModal());
        document.getElementById('eventModal').addEventListener('click', (e) => {
            if (e.target.id === 'eventModal') this.closeModal();
        });
        
        document.addEventListener('keydown', (e) => this.handleKeyboard(e));
    }

    handleSearch() {
        const term = document.getElementById('searchInput').value.trim();
        this.filters.search = term;
        this.applyFilters();
        this.updateActivePills();
    }

    handlePeriodFilter() {
        const period = document.getElementById('periodFilter').value;
        this.filters.period = period;
        this.applyFilters();
        this.updateActivePills();
    }

    handleTagFilter() {
        const tag = document.getElementById('tagFilter').value;
        this.filters.tag = tag;
        this.applyFilters();
        this.updateActivePills();
    }

    applyFilters() {
        this.filteredEvents = this.events.filter(event => {
            const matchesSearch = !this.filters.search || 
                this.searchInEvent(event, this.filters.search.toLowerCase());
            
            const matchesPeriod = !this.filters.period || 
                event.period === this.filters.period;
            
            const matchesTag = !this.filters.tag || 
                event.tags.includes(this.filters.tag);
            
            return matchesSearch && matchesPeriod && matchesTag;
        });
        
        this.filteredEvents.sort((a, b) => a.year - b.year);
        this.currentPage = 1;
        this.renderEvents();
        this.renderPagination();
        this.updateStats();
        this.populateFilterOptions();
        this.renderActiveTabContent();
    }

    searchInEvent(event, term) {
        const searchFields = [
            event.title,
            event.description,
            event.detailedDescription,
            event.location,
            event.period,
            ...event.personalities,
            ...event.tags
        ].join(' ').toLowerCase();
        
        return searchFields.includes(term);
    }

    renderEvents() {
        const grid = document.getElementById('eventsGrid');
        const loading = document.getElementById('loadingIndicator');
        const empty = document.getElementById('emptyState');
        
        if (this.filteredEvents.length === 0) {
            grid.innerHTML = '';
            empty.style.display = 'block';
            loading.style.display = 'none';
            return;
        }
        
        empty.style.display = 'none';
        loading.style.display = 'none';
        
        const start = (this.currentPage - 1) * this.itemsPerPage;
        const end = start + this.itemsPerPage;
        const pageEvents = this.filteredEvents.slice(start, end);
        
        grid.innerHTML = pageEvents.map(event => this.createEventCard(event)).join('');
        
        grid.querySelectorAll('.event-card').forEach((card, index) => {
            card.addEventListener('click', () => this.showEventModal(pageEvents[index]));
        });
    }

    createEventCard(event) {
        return `
            <div class="event-card" data-id="${event.id}">
                <div class="event-header">
                    <h3 class="event-title">${event.title}</h3>
                    <div class="event-meta">
                        <span><i class="fas fa-calendar"></i> ${event.year}</span>
                        <span><i class="fas fa-clock"></i> ${event.hijriYear}</span>
                    </div>
                </div>
                <div class="event-body">
                    <p class="event-description">${event.description}</p>
                    <div class="event-tags">
                        ${event.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </div>
                <div class="event-footer">
                    <span class="event-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${event.location}
                    </span>
                    <span class="significance">
                        ${'★'.repeat(event.significance)}${'☆'.repeat(5-event.significance)}
                    </span>
                </div>
            </div>
        `;
    }

    renderPagination() {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(this.filteredEvents.length / this.itemsPerPage);
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }
        
        let html = '';
        
        if (this.currentPage > 1) {
            html += `<button class="page-btn" onclick="app.changePage(${this.currentPage - 1})">
                <i class="fas fa-chevron-right"></i>
            </button>`;
        }
        
        const startPage = Math.max(1, this.currentPage - 2);
        const endPage = Math.min(totalPages, this.currentPage + 2);
        
        for (let i = startPage; i <= endPage; i++) {
            html += `<button class="page-btn ${i === this.currentPage ? 'active' : ''}" 
                     onclick="app.changePage(${i})">${i}</button>`;
        }
        
        if (this.currentPage < totalPages) {
            html += `<button class="page-btn" onclick="app.changePage(${this.currentPage + 1})">
                <i class="fas fa-chevron-left"></i>
            </button>`;
        }
        
        pagination.innerHTML = html;
    }

    changePage(page) {
        this.currentPage = page;
        this.renderEvents();
        this.renderPagination();
        document.getElementById('eventsTab').scrollIntoView({ behavior: 'smooth' });
    }

    showEventModal(event) {
        const modal = document.getElementById('eventModal');
        
        document.getElementById('modalTitle').textContent = event.title;
        document.getElementById('modalMeta').innerHTML = `
            <span><i class="fas fa-calendar"></i> ${event.year}</span>
            <span><i class="fas fa-clock"></i> ${event.hijriYear}</span>
            <span><i class="fas fa-star"></i> ${event.significance}/5</span>
        `;
        
        document.getElementById('modalDetails').innerHTML = `
            <div class="detail-item">
                <div class="detail-label">تفصیلی وضاحت</div>
                <div class="detail-value">${event.detailedDescription}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">مقام</div>
                <div class="detail-value">${event.location}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">متعلقہ شخصیات</div>
                <div class="detail-value">${event.personalities.join(', ')}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">ٹیگز</div>
                <div class="detail-value">
                    ${event.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">کوآرڈینیٹس</div>
                <div class="detail-value">${event.coordinates}</div>
            </div>
        `;
        
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    closeModal() {
        document.getElementById('eventModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    switchTab(tabName) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`${tabName}Tab`).classList.add('active');
        
        this.renderActiveTabContent();
    }

    renderActiveTabContent() {
        const activeTab = document.querySelector('.tab.active').dataset.tab;
        
        switch(activeTab) {
            case 'timeline':
                this.renderTimeline();
                break;
            case 'analytics':
                this.renderAnalytics();
                break;
            case 'insights':
                this.renderInsights();
                break;
        }
    }

    // Complete Timeline Infographic Methods - Replace all timeline related methods

renderTimeline() {
    const container = document.getElementById('timelineContainer');
    
    if (this.filteredEvents.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-timeline"></i><h3>کوئی واقعات نہیں ملے</h3></div>';
        return;
    }

    const periods = this.groupEventsByPeriod();
    const currentPeriod = this.currentTimelinePeriod || Object.keys(periods)[0];
    
    container.innerHTML = `
        <div class="timeline-infographic">
            <div class="timeline-period-filter">
                ${Object.keys(periods).map(period => `
                    <button class="period-filter-btn ${period === currentPeriod ? 'active' : ''}" 
                            onclick="app.switchTimelinePeriod('${period}')">
                        ${period} (${periods[period].length})
                    </button>
                `).join('')}
            </div>
            
            <div class="timeline-main-line"></div>
            
            ${Object.entries(periods).map(([period, events]) => `
                <div class="timeline-period-section ${period === currentPeriod ? 'active' : ''}" 
                     data-period="${period}">
                    <div class="timeline-events-container">
                        ${events.map((event, index) => this.createTimelineEventCard(event, index)).join('')}
                    </div>
                </div>
            `).join('')}
            
            <div class="timeline-navigation">
                <button class="timeline-nav-btn" onclick="app.previousTimelinePeriod()">
                    <i class="fas fa-chevron-right"></i> پچھلا دور
                </button>
                <button class="timeline-nav-btn" onclick="app.nextTimelinePeriod()">
                    اگلا دور <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </div>
    `;
}

createTimelineEventCard(event, index) {
    const icons = {
        'ولادت': 'fa-baby',
        'وحی': 'fa-book-open',
        'ہجرت': 'fa-route',
        'غزوہ': 'fa-shield-alt',
        'جنگ': 'fa-crossed-swords',
        'صلح': 'fa-handshake',
        'فتح': 'fa-flag',
        'حج': 'fa-kaaba',
        'معراج': 'fa-cloud',
        'نبوت': 'fa-star-and-crescent',
        'مکی دور': 'fa-mosque',
        'مدنی دور': 'fa-city'
    };
    
    const getIcon = (tags) => {
        for (const tag of tags) {
            if (icons[tag]) return icons[tag];
        }
        return 'fa-star';
    };

    const gradientColors = [
        'linear-gradient(135deg, #667eea, #764ba2)',
        'linear-gradient(135deg, #f093fb, #f5576c)',
        'linear-gradient(135deg, #4facfe, #00f2fe)',
        'linear-gradient(135deg, #43e97b, #38f9d7)',
        'linear-gradient(135deg, #fa709a, #fee140)',
        'linear-gradient(135deg, #a8edea, #fed6e3)'
    ];

    return `
        <div class="timeline-event-item" onclick="app.showTimelineEventModal(${event.id})">
            <div class="timeline-year-badge" style="background: ${gradientColors[index % gradientColors.length]}">
                ${event.year}
            </div>
            <div class="timeline-event-card">
                <div class="timeline-event-icon" style="background: ${gradientColors[index % gradientColors.length]}">
                    <i class="fas ${getIcon(event.tags)}"></i>
                </div>
                <h4 class="timeline-event-title">${event.title}</h4>
                <p class="timeline-event-description">${event.description.substring(0, 100)}${event.description.length > 100 ? '...' : ''}</p>
                <div class="timeline-event-meta">
                    <span><i class="fas fa-calendar"></i> ${event.hijriYear}</span>
                    <span><i class="fas fa-star"></i> ${event.significance}/5</span>
                </div>
                <div class="timeline-event-tags">
                    ${event.tags.slice(0, 3).map(tag => 
                        `<span class="timeline-tag-mini">${tag}</span>`
                    ).join('')}
                </div>
                ${event.location ? `
                    <div class="timeline-event-location">
                        <i class="fas fa-map-marker-alt"></i> ${event.location}
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

groupEventsByPeriod() {
    const periods = {};
    
    this.filteredEvents.forEach(event => {
        const period = event.period || 'نامعلوم';
        if (!periods[period]) {
            periods[period] = [];
        }
        periods[period].push(event);
    });
    
    Object.values(periods).forEach(periodEvents => {
        periodEvents.sort((a, b) => a.year - b.year);
    });
    
    return periods;
}

switchTimelinePeriod(period) {
    this.currentTimelinePeriod = period;
    
    document.querySelectorAll('.period-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.includes(period)) {
            btn.classList.add('active');
        }
    });
    
    document.querySelectorAll('.timeline-period-section').forEach(section => {
        section.classList.toggle('active', section.dataset.period === period);
    });
    
    this.showToast(`${period} کا دور منتخب کیا گیا`, 'info');
}

nextTimelinePeriod() {
    const periods = Object.keys(this.groupEventsByPeriod());
    const currentIndex = periods.indexOf(this.currentTimelinePeriod || periods[0]);
    const nextIndex = (currentIndex + 1) % periods.length;
    this.switchTimelinePeriod(periods[nextIndex]);
}

previousTimelinePeriod() {
    const periods = Object.keys(this.groupEventsByPeriod());
    const currentIndex = periods.indexOf(this.currentTimelinePeriod || periods[0]);
    const prevIndex = currentIndex === 0 ? periods.length - 1 : currentIndex - 1;
    this.switchTimelinePeriod(periods[prevIndex]);
}

showTimelineEventModal(eventId) {
    const event = this.events.find(e => e.id === eventId);
    if (event) {
        this.showEventModal(event);
    }
}

initializeTimeline() {
    this.currentTimelinePeriod = null;
    
    const style = document.createElement('style');
    style.textContent = `
        .timeline-infographic {
            position: relative;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: var(--radius-xl);
            margin: 2rem 0;
            overflow-x: auto;
        }

        .timeline-main-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            border-radius: 3px;
            transform: translateY(-50%);
        }

        .timeline-period-filter {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .period-filter-btn {
            padding: 0.5rem 1.5rem;
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            background: rgba(255,255,255,0.8);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            backdrop-filter: blur(10px);
            font-family: var(--font-urdu);
        }

        .period-filter-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .period-filter-btn:hover:not(.active) {
            background: rgba(255,255,255,0.9);
            transform: translateY(-2px);
        }

        .timeline-events-container {
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            gap: 2rem;
            padding: 2rem 0;
            overflow-x: auto;
        }

        .timeline-event-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 200px;
            cursor: pointer;
            z-index: 10;
        }

        .timeline-event-item:nth-child(odd) {
            flex-direction: column;
            align-items: center;
            margin-top: -120px;
        }

        .timeline-event-item:nth-child(even) {
            flex-direction: column-reverse;
            align-items: center;
            margin-top: 120px;
        }

        .timeline-year-badge {
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-xl);
            font-size: 1.25rem;
            font-weight: 700;
            box-shadow: var(--shadow-lg);
            margin: 1rem 0;
            position: relative;
            z-index: 5;
            font-family: var(--font-urdu);
        }

        .timeline-year-badge::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: inherit;
            transform: translate(-50%, -50%) rotate(45deg);
            z-index: -1;
        }

        .timeline-event-item:nth-child(even) .timeline-year-badge::after {
            top: -10px;
        }

        .timeline-event-item:nth-child(odd) .timeline-year-badge::after {
            bottom: -10px;
            top: auto;
        }

        .timeline-event-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            max-width: 280px;
            transition: var(--transition);
            border: 3px solid transparent;
            position: relative;
        }

        .timeline-event-card::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .timeline-event-item:nth-child(odd) .timeline-event-card::before {
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        .timeline-event-item:nth-child(even) .timeline-event-card::before {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid white;
        }

        .timeline-event-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--accent-primary);
        }

        .timeline-event-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-md);
        }

        .timeline-event-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-align: center;
            font-family: var(--font-urdu);
        }

        .timeline-event-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.4;
            font-family: var(--font-urdu);
        }

        .timeline-event-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            width: 100%;
        }

        .timeline-event-tags {
            display: flex;
            gap: 0.25rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        .timeline-tag-mini {
            background: var(--accent-primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            font-weight: 500;
            font-family: var(--font-urdu);
        }

        .timeline-event-location {
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            font-family: var(--font-urdu);
        }

        .timeline-period-section {
            display: none;
        }

        .timeline-period-section.active {
            display: block;
        }

        .timeline-navigation {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .timeline-nav-btn {
            background: var(--bg-card);
            border: 2px solid var(--border-light);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            font-family: var(--font-urdu);
        }

        .timeline-nav-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .timeline-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .timeline-infographic {
                padding: 2rem 1rem;
            }
            
            .timeline-events-container {
                flex-direction: column;
                gap: 3rem;
            }
            
            .timeline-event-item:nth-child(odd),
            .timeline-event-item:nth-child(even) {
                margin-top: 0;
                flex-direction: column;
            }
            
            .timeline-main-line {
                transform: translateY(-50%) rotate(90deg);
                height: 100%;
                width: 6px;
                left: 50%;
                right: auto;
            }
            
            .timeline-year-badge::after {
                display: none;
            }
            
            .timeline-event-card::before {
                display: none;
            }
        }
    `;
    
    if (!document.querySelector('#timeline-styles')) {
        style.id = 'timeline-styles';
        document.head.appendChild(style);
    }
}

// Call this in your constructor
// this.initializeTimeline();


    renderAnalytics() {
        this.renderPeriodsChart();
        this.renderLocationsChart();
        this.renderTagsChart();
    }

    renderPeriodsChart() {
        const svg = document.getElementById('periodsChart');
        const periods = this.groupBy(this.filteredEvents, 'period');
        this.createBarChart(svg, periods, 'period');
    }

    renderLocationsChart() {
        const svg = document.getElementById('locationsChart');
        const locations = this.groupBy(this.filteredEvents, 'location');
        this.createBarChart(svg, locations, 'location');
    }

    renderTagsChart() {
        const svg = document.getElementById('tagsChart');
        const allTags = this.filteredEvents.flatMap(event => event.tags);
        const tagCounts = {};
        allTags.forEach(tag => tagCounts[tag] = (tagCounts[tag] || 0) + 1);
        
        const topTags = Object.entries(tagCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 10)
            .reduce((obj, [tag, count]) => ({ ...obj, [tag]: count }), {});
        
        this.createBarChart(svg, topTags, 'tags');
    }

    createBarChart(svg, data, type) {
        const margin = { top: 20, right: 30, bottom: 80, left: 60 };
        const width = 800 - margin.left - margin.right;
        const height = 300 - margin.top - margin.bottom;
        
        svg.innerHTML = '';
        
        const entries = Object.entries(data);
        const maxValue = Math.max(...entries.map(([, count]) => count));
        
        const barWidth = width / entries.length * 0.8;
        const barSpacing = width / entries.length * 0.2;
        
        entries.forEach(([key, value], index) => {
            const barHeight = (value / maxValue) * height;
            const x = margin.left + index * (barWidth + barSpacing);
            const y = margin.top + height - barHeight;
            
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', x);
            rect.setAttribute('y', y);
            rect.setAttribute('width', barWidth);
            rect.setAttribute('height', barHeight);
            rect.setAttribute('fill', '#3b82f6');
            rect.setAttribute('rx', '3');
            svg.appendChild(rect);
            
            const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            valueText.setAttribute('x', x + barWidth / 2);
            valueText.setAttribute('y', y - 5);
            valueText.setAttribute('text-anchor', 'middle');
            valueText.setAttribute('fill', 'var(--text-primary)');
            valueText.setAttribute('font-size', '12');
            valueText.textContent = value;
            svg.appendChild(valueText);
            
            const labelText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            labelText.setAttribute('x', x + barWidth / 2);
            labelText.setAttribute('y', margin.top + height + 20);
            labelText.setAttribute('text-anchor', 'middle');
            labelText.setAttribute('fill', 'var(--text-secondary)');
            labelText.setAttribute('font-size', '11');
            labelText.setAttribute('font-family', 'var(--font-urdu)');
            labelText.textContent = key.length > 15 ? key.substring(0, 12) + '...' : key;
            svg.appendChild(labelText);
        });
        
        svg.setAttribute('width', 800);
        svg.setAttribute('height', 300);
    }

    renderInsights() {
        this.renderPersonalitiesInsight();
        this.renderLocationsInsight();
        this.renderTopicsInsight();
    }

    renderPersonalitiesInsight() {
        const grid = document.getElementById('personalitiesGrid');
        const allPersonalities = this.filteredEvents.flatMap(event => event.personalities);
        const personalityCounts = {};
        
        allPersonalities.forEach(person => {
            personalityCounts[person] = (personalityCounts[person] || 0) + 1;
        });
        
        const topPersonalities = Object.entries(personalityCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 8);
        
        grid.innerHTML = topPersonalities.map(([name, count]) => `
            <div class="insight-card" onclick="app.filterByPersonality('${name}')">
                <div class="insight-value">${count}</div>
                <div>${name}</div>
            </div>
        `).join('');
    }

    renderLocationsInsight() {
        const grid = document.getElementById('locationsGrid');
        const locationCounts = this.groupBy(this.filteredEvents, 'location');
        
        const topLocations = Object.entries(locationCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 8);
        
        grid.innerHTML = topLocations.map(([location, count]) => `
            <div class="insight-card" onclick="app.filterByLocation('${location}')">
                <div class="insight-value">${count}</div>
                <div>${location}</div>
            </div>
        `).join('');
    }

    renderTopicsInsight() {
        const grid = document.getElementById('topicsGrid');
        const allTags = this.filteredEvents.flatMap(event => event.tags);
        const tagCounts = {};
        
        allTags.forEach(tag => {
            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
        });
        
        const topTags = Object.entries(tagCounts)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 12);
        
        grid.innerHTML = topTags.map(([tag, count]) => `
            <div class="insight-card" onclick="app.filterByTag('${tag}')">
                <div class="insight-value">${count}</div>
                <div>${tag}</div>
            </div>
        `).join('');
    }

    filterByPersonality(name) {
        document.getElementById('searchInput').value = name;
        this.filters.search = name;
        this.applyFilters();
        this.switchTab('events');
        this.showToast(`${name} کے واقعات فلٹر کیے گئے`, 'success');
    }

    filterByLocation(location) {
        document.getElementById('searchInput').value = location;
        this.filters.search = location;
        this.applyFilters();
        this.switchTab('events');
        this.showToast(`${location} کے واقعات فلٹر کیے گئے`, 'success');
    }

    filterByTag(tag) {
        document.getElementById('tagFilter').value = tag;
        this.filters.tag = tag;
        this.applyFilters();
        this.switchTab('events');
        this.showToast(`${tag} کے واقعات فلٹر کیے گئے`, 'success');
    }

    updateStats() {
        document.getElementById('totalEventsCount').textContent = this.events.length;
        document.getElementById('filteredEventsCount').textContent = this.filteredEvents.length;
        
        const uniquePeriods = new Set(this.events.map(e => e.period));
        document.getElementById('uniquePeriodsCount').textContent = uniquePeriods.size;
        
        const uniqueLocations = new Set(this.events.map(e => e.location));
        document.getElementById('uniqueLocationCount').textContent = uniqueLocations.size;
    }

    populateFilterOptions() {
        const periodFilter = document.getElementById('periodFilter');
        const tagFilter = document.getElementById('tagFilter');
        
        const periods = [...new Set(this.events.map(e => e.period))];
        const tags = [...new Set(this.events.flatMap(e => e.tags))];
        
        periodFilter.innerHTML = '<option value="">تمام ادوار</option>' +
            periods.map(period => `<option value="${period}">${period}</option>`).join('');
        
        tagFilter.innerHTML = '<option value="">تمام ٹیگز</option>' +
            tags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
    }

    updateActivePills() {
        const container = document.getElementById('activePills');
        const pills = [];
        
        if (this.filters.search) {
            pills.push(`تلاش: ${this.filters.search}`);
        }
        if (this.filters.period) {
            pills.push(`دور: ${this.filters.period}`);
        }
        if (this.filters.tag) {
            pills.push(`ٹیگ: ${this.filters.tag}`);
        }
        
        container.innerHTML = pills.map(pill => `
            <span class="pill">
                ${pill}
                <button class="pill-remove" onclick="app.removePill('${pill.split(': ')[0]}')">&times;</button>
            </span>
        `).join('');
    }

    removePill(type) {
        switch(type) {
            case 'تلاش':
                document.getElementById('searchInput').value = '';
                this.filters.search = '';
                break;
            case 'دور':
                document.getElementById('periodFilter').value = '';
                this.filters.period = '';
                break;
            case 'ٹیگ':
                document.getElementById('tagFilter').value = '';
                this.filters.tag = '';
                break;
        }
        this.applyFilters();
        this.updateActivePills();
    }

    clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('periodFilter').value = '';
        document.getElementById('tagFilter').value = '';
        
        this.filters = { search: '', period: '', tag: '' };
        this.applyFilters();
        this.updateActivePills();
        this.showToast('تمام فلٹرز صاف کر دیے گئے', 'success');
    }

    toggleTheme() {
        const body = document.body;
        const isDark = body.classList.contains('dark');
        const themeBtn = document.getElementById('themeToggle');
        
        if (isDark) {
            body.classList.remove('dark');
            themeBtn.innerHTML = '<i class="fas fa-moon"></i> تھیم';
            localStorage.setItem('theme', 'light');
        } else {
            body.classList.add('dark');
            themeBtn.innerHTML = '<i class="fas fa-sun"></i> تھیم';
            localStorage.setItem('theme', 'dark');
        }
    }

    loadTheme() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
            document.body.classList.add('dark');
            document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i> تھیم';
        }
    }

    exportJSON() {
        const data = {
            events: this.filteredEvents,
            exportDate: new Date().toISOString(),
            totalEvents: this.filteredEvents.length
        };
        
        this.downloadFile(JSON.stringify(data, null, 2), 'seerah-data.json', 'application/json');
        this.showToast('JSON فائل ایکسپورٹ ہو گئی', 'success');
    }

    exportCSV() {
        const headers = ['ID', 'عنوان', 'سال', 'ہجری سال', 'دور', 'مقام', 'تفصیل', 'شخصیات', 'ٹیگز'];
        const rows = this.filteredEvents.map(event => [
            event.id,
            event.title,
            event.year,
            event.hijriYear,
            event.period,
            event.location,
            event.description.replace(/,/g, ';'),
            event.personalities.join(';'),
            event.tags.join(';')
        ]);
        
        const csvContent = [headers, ...rows].map(row => row.join(',')).join('\n');
        this.downloadFile(csvContent, 'seerah-data.csv', 'text/csv');
        this.showToast('CSV فائل ایکسپورٹ ہو گئی', 'success');
    }

    async importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        try {
            const text = await file.text();
            let data;
            
            if (file.name.endsWith('.json')) {
                data = JSON.parse(text);
                if (data.events && Array.isArray(data.events)) {
                    await this.addEventsToDB(data.events);
                    this.events = [...this.events, ...data.events];
                }
            } else if (file.name.endsWith('.csv')) {
                const lines = text.split('\n');
                const headers = lines[0].split(',');
                data = lines.slice(1).map(line => {
                    const values = line.split(',');
                    return {
                        id: parseInt(values[0]) || Date.now(),
                        title: values[1],
                        year: parseInt(values[2]),
                        hijriYear: values[3],
                        period: values[4],
                        location: values[5],
                        description: values[6].replace(/;/g, ','),
                        personalities: values[7] ? values[7].split(';') : [],
                        tags: values[8] ? values[8].split(';') : [],
                        significance: 3
                    };
                }).filter(event => event.title);
                
                await this.addEventsToDB(data);
                this.events = [...this.events, ...data];
            }
            
            this.applyFilters();
            this.showToast('ڈیٹا کامیابی سے امپورٹ ہوا', 'success');
        } catch (error) {
            console.error('Import error:', error);
            this.showToast('فائل امپورٹ کرنے میں خرابی', 'error');
        }
    }

    downloadFile(content, filename, contentType) {
        const blob = new Blob([content], { type: contentType });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    handleKeyboard(e) {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'f':
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                    break;
                case 'k':
                    e.preventDefault();
                    this.clearFilters();
                    break;
                case 's':
                    e.preventDefault();
                    this.exportJSON();
                    break;
            }
        }
        
        if (e.key === 'Escape') {
            this.closeModal();
        }
    }

    showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            ${message}
        `;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }

    groupBy(array, key) {
        return array.reduce((groups, item) => {
            const group = item[key];
            groups[group] = (groups[group] || 0) + 1;
            return groups;
        }, {});
    }

    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    async forceDataRefresh() {
        try {
            this.showToast('ڈیٹا ریفریش ہو رہا ہے...', 'info');
            
            const csvData = await this.dataLoader.loadAllData();
            
            if (csvData.events.length > 0) {
                await this.clearEventsFromDB();
                await this.addEventsToDB(csvData.events);
                
                this.events = csvData.events;
                this.applyFilters();
                this.updateStats();
                
                localStorage.setItem('lastFetch', Date.now().toString());
                this.showToast(`ڈیٹا ریفریش مکمل: ${csvData.events.length} واقعات`, 'success');
            } else {
                this.showToast('کوئی ڈیٹا نہیں ملا', 'warning');
            }
        } catch (error) {
            console.error('ریفریش ناکام:', error);
            this.showToast('ریفریش کرنے میں خرابی: ' + error.message, 'error');
        }
    }

    async clearEventsFromDB() {
        return new Promise((resolve, reject) => {
            const transaction = this.db.transaction(['events'], 'readwrite');
            const store = transaction.objectStore('events');
            const request = store.clear();
            
            request.onsuccess = () => resolve();
            request.onerror = () => reject(request.error);
        });
    }
}

let app;
document.addEventListener('DOMContentLoaded', () => {
    app = new SeerahApp();
});
</script>

    
    <!-- Author: Yasin Ullah, Pakistani -->
</body>
</html>
<script>
(function() {
    const disclaimerShown = localStorage.getItem('disclaimerShown');
    
    if (!disclaimerShown) {
        showDisclaimerModal();
    }
    
    function showDisclaimerModal() {
        const modalHTML = `
            <div id="disclaimerModal" style="
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(5px);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
                direction: rtl;
                animation: fadeIn 0.3s ease;
            ">
                <div style="
                    background: white;
                    border-radius: 20px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    position: relative;
                    animation: slideUp 0.3s ease;
                ">
                    <div style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 2rem;
                        border-radius: 20px 20px 0 0;
                        text-align: center;
                    ">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem; color: #fbbf24;"></i>
                        <h2 style="margin: 0; font-size: 1.75rem; font-weight: 700;">اہم اطلاع</h2>
                        <p style="margin: 0.5rem 0 0 0; font-size: 1.1rem; opacity: 0.9;">Disclaimer - نوٹ</p>
                    </div>
                    
                    <div style="padding: 2rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #dc2626; margin-bottom: 1rem; font-size: 1.25rem; font-weight: 600;">
                                <i class="fas fa-info-circle"></i> پروٹوٹائپ نوٹس
                            </h3>
                            <div style="background: #fef2f2; border: 2px solid #fecaca; border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem;">
                                <p style="margin: 0 0 1rem 0; line-height: 1.6; color: #7f1d1d;">
                                    یہ ایپلیکیشن صرف ایک <strong>پروٹوٹائپ</strong> ہے۔ اس میں موجود ڈیٹا اور معلومات کی تصدیق نہیں کی گئی ہے اور یہ مکمل طور پر درست نہیں ہو سکتی۔
                                </p>
                                <p style="margin: 0; line-height: 1.6; color: #7f1d1d;">
                                    This application is a <strong>prototype</strong>. The data and information contained may not be factual or verified.
                                </p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: #059669; margin-bottom: 1rem; font-size: 1.25rem; font-weight: 600;">
                                <i class="fas fa-code"></i> اوپن سورس
                            </h3>
                            <div style="background: #f0fdf4; border: 2px solid #bbf7d0; border-radius: 10px; padding: 1.5rem;">
                                <p style="margin: 0 0 1rem 0; line-height: 1.6; color: #064e3b;">
                                    یہ ایپلیکیشن مکمل طور پر اوپن سورس ہے۔ آپ اسے استعمال، تبدیل اور تقسیم کر سکتے ہیں۔
                                </p>
                                <p style="margin: 0; line-height: 1.6; color: #064e3b;">
                                    This application is open source. You can use, modify and distribute it freely.
                                </p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <h3 style="color: #7c3aed; margin-bottom: 1rem; font-size: 1.25rem; font-weight: 600;">
                                <i class="fas fa-user-cog"></i> ڈیولپر
                            </h3>
                            <div style="background: #f5f3ff; border: 2px solid #c4b5fd; border-radius: 10px; padding: 1.5rem; text-align: center;">
                                <p style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #5b21b6;">
                                    Author: Yasin Ullah (Pakistani)
                                </p>
                                <p style="margin: 0.5rem 0 0 0; color: #6b21a8;">
                                    مصنف: یاسین اللہ (پاکستانی)
                                </p>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button id="disclaimerAccept" style="
                                background: linear-gradient(135deg, #059669, #10b981);
                                color: white;
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 10px;
                                font-size: 1.1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
                                min-width: 150px;
                            ">
                                <i class="fas fa-check"></i> سمجھ گیا
                            </button>
                            
                            <button id="disclaimerCancel" style="
                                background: #6b7280;
                                color: white;
                                border: none;
                                padding: 1rem 2rem;
                                border-radius: 10px;
                                font-size: 1.1rem;
                                font-weight: 600;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                font-family: 'Noto Nastaliq Urdu', Arial, sans-serif;
                                min-width: 150px;
                            ">
                                <i class="fas fa-times"></i> بند کریں
                            </button>
                        </div>
                        
                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #e5e7eb; text-align: center;">
                            <label style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: #6b7280; cursor: pointer;">
                                <input type="checkbox" id="dontShowAgain" style="margin: 0;">
                                <span>دوبارہ نہ دکھائیں / Don't show again</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes slideUp {
                from { transform: translateY(50px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
            
            #disclaimerModal button:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            }
            
            #disclaimerAccept:hover {
                background: linear-gradient(135deg, #047857, #059669) !important;
            }
            
            #disclaimerCancel:hover {
                background: #4b5563 !important;
            }
        `;
        
        document.head.appendChild(style);
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        document.body.style.overflow = 'hidden';
        
        document.getElementById('disclaimerAccept').addEventListener('click', function() {
            const dontShow = document.getElementById('dontShowAgain').checked;
            if (dontShow) {
                localStorage.setItem('disclaimerShown', 'true');
            }
            closeModal();
        });
        
        document.getElementById('disclaimerCancel').addEventListener('click', function() {
            closeModal();
        });
        
        document.getElementById('disclaimerModal').addEventListener('click', function(e) {
            if (e.target.id === 'disclaimerModal') {
                closeModal();
            }
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        
        function closeModal() {
            const modal = document.getElementById('disclaimerModal');
            if (modal) {
                modal.style.animation = 'fadeIn 0.3s ease reverse';
                setTimeout(() => {
                    modal.remove();
                    document.body.style.overflow = 'auto';
                }, 300);
            }
        }
    }
})();
</script>
